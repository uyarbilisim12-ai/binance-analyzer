<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Binance Alarm Mesajlarƒ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #1e1e2e;
            color: #cdd6f4;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: #313244;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            color: #74c7ec;
            margin-bottom: 20px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .header-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        /* Kopyalama kontrolleri */
        .copy-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 15px;
            padding: 15px;
            background-color: #1e1e2e;
            border-radius: 8px;
        }
        
        .copy-button {
            padding: 8px 12px;
            background-color: #74c7ec;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .copy-button:hover {
            background-color: #89b4fa;
        }
        
        .copy-button.select-all {
            background-color: #a6e3a1;
        }
        
        .copy-button.select-all:hover {
            background-color: #94d2a1;
        }
        
        .copy-button.deselect-all {
            background-color: #f38ba8;
        }
        
        .copy-button.deselect-all:hover {
            background-color: #f5a5c0;
        }
        
        .copy-button.copy-selected {
            background-color: #cba6f7;
        }
        
        .copy-button.copy-selected:hover {
            background-color: #d8b9f9;
        }
        
        .copy-button.copy-all {
            background-color: #f9e2af;
            color: #1e1e2e;
        }
        
        .copy-button.copy-all:hover {
            background-color: #fce8b7;
        }
        
        .selected-count {
            font-size: 12px;
            color: #a6adc8;
            padding: 5px 10px;
            background-color: #45475a;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .selected-count span {
            color: #74c7ec;
            font-size: 14px;
        }
        
        .filter-section {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 15px;
            padding: 15px;
            background-color: #1e1e2e;
            border-radius: 8px;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .filter-label {
            font-size: 12px;
            color: #a6adc8;
            font-weight: bold;
        }
        
        select {
            padding: 8px 12px;
            border: 2px solid #45475a;
            border-radius: 6px;
            background-color: #1e1e2e;
            color: #cdd6f4;
            cursor: pointer;
            min-width: 150px;
        }
        
        select:focus {
            outline: none;
            border-color: #74c7ec;
        }
        
        .filter-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .filter-tag {
            padding: 6px 12px;
            background-color: #45475a;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .filter-tag:hover {
            background-color: #5a5d7a;
        }
        
        .filter-tag.active {
            background-color: #74c7ec;
            color: #1e1e2e;
            font-weight: bold;
        }
        
        button {
            padding: 10px 15px;
            background-color: #74c7ec;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        
        button:hover {
            background-color: #89b4fa;
        }
        
        .clear-btn {
            background-color: #f38ba8;
        }
        
        .clear-btn:hover {
            background-color: #f5a5c0;
        }
        
        .clear-filters-btn {
            background-color: #f9e2af;
            color: #1e1e2e;
        }
        
        .clear-filters-btn:hover {
            background-color: #fce8b7;
        }
        
        .info-box {
            background-color: #1e1e2e;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .stats {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .stat-card {
            background-color: #1e1e2e;
            padding: 15px;
            border-radius: 8px;
            flex: 1;
            min-width: 120px;
            text-align: center;
        }
        
        .stat-label {
            font-size: 12px;
            color: #a6adc8;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: bold;
        }
        
        .stat-value.total {
            color: #74c7ec;
        }
        
        .stat-value.filtered {
            color: #a6e3a1;
        }
        
        .stat-value.upper {
            color: #f9e2af;
        }
        
        .stat-value.lower {
            color: #f38ba8;
        }
        
        .stat-value.high {
            color: #89b4fa;
        }
        
        .stat-value.low {
            color: #cba6f7;
        }
        
        .stat-value.change {
            color: #cba6f7;
        }
        
        .stat-value.ema {
            color: #89b4fa;
        }
        
        .alarm-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .alarm-item {
            background-color: #1e1e2e;
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid #74c7ec;
            animation: slideIn 0.3s ease-out;
        }
        
        .alarm-item.upper {
            border-left-color: #f9e2af;
            background-color: rgba(249, 226, 175, 0.05);
        }
        
        .alarm-item.lower {
            border-left-color: #f38ba8;
            background-color: rgba(243, 139, 168, 0.05);
        }
        
        .alarm-item.high {
            border-left-color: #89b4fa;
            background-color: rgba(137, 180, 250, 0.05);
        }
        
        .alarm-item.low {
            border-left-color: #cba6f7;
            background-color: rgba(203, 166, 247, 0.05);
        }
        
        .alarm-item.change {
            border-left-color: #cba6f7;
            background-color: rgba(203, 166, 247, 0.05);
        }
        
        .alarm-item.ema {
            border-left-color: #89b4fa;
            background-color: rgba(137, 180, 250, 0.05);
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .alarm-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .coin-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .coin-symbol-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .coin-checkbox {
            width: 16px;
            height: 16px;
            cursor: pointer;
            accent-color: #74c7ec;
        }
        
        .coin-symbol {
            font-weight: bold;
            font-size: 18px;
            color: #74c7ec;
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .coin-symbol:hover {
            color: #89b4fa;
        }
        
        .coin-symbol.selected {
            color: #a6e3a1;
        }
        
        .copy-icon {
            color: #a6adc8;
            cursor: pointer;
            font-size: 12px;
            padding: 4px;
            border-radius: 3px;
            transition: all 0.2s;
            background-color: transparent;
            border: none;
        }
        
        .copy-icon:hover {
            color: #74c7ec;
            background-color: rgba(116, 199, 236, 0.1);
        }
        
        .alarm-type {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .type-upper {
            background-color: rgba(249, 226, 175, 0.2);
            color: #f9e2af;
        }
        
        .type-lower {
            background-color: rgba(243, 139, 168, 0.2);
            color: #f38ba8;
        }
        
        .type-high {
            background-color: rgba(137, 180, 250, 0.2);
            color: #89b4fa;
        }
        
        .type-low {
            background-color: rgba(203, 166, 247, 0.2);
            color: #cba6f7;
        }
        
        .type-change {
            background-color: rgba(203, 166, 247, 0.2);
            color: #cba6f7;
        }
        
        .type-ema {
            background-color: rgba(137, 180, 250, 0.2);
            color: #89b4fa;
        }
        
        .time-info {
            font-size: 12px;
            color: #a6adc8;
        }
        
        .price-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #45475a;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .price-item {
            flex: 1;
            min-width: 150px;
        }
        
        .price-label {
            font-size: 12px;
            color: #a6adc8;
            margin-bottom: 3px;
        }
        
        .price-value {
            font-weight: bold;
            font-size: 16px;
        }
        
        .current-price {
            color: #74c7ec;
        }
        
        .target-price {
            color: #f9e2af;
        }
        
        .positive {
            color: #a6e3a1;
        }
        
        .negative {
            color: #f38ba8;
        }
        
        .difference {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 11px;
            margin-left: 5px;
        }
        
        .diff-positive {
            background-color: rgba(166, 227, 161, 0.2);
            color: #a6e3a1;
        }
        
        .diff-negative {
            background-color: rgba(243, 139, 168, 0.2);
            color: #f38ba8;
        }
        
        /* Hacim bilgileri i√ßin √∂zel stiller */
        .volume-info {
            font-size: 11px;
            line-height: 1.4;
            margin-top: 10px;
            padding: 8px;
            background-color: rgba(30, 30, 46, 0.7);
            border-radius: 6px;
            border: 1px solid #45475a;
        }
        
        .volume-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
            padding-bottom: 4px;
            border-bottom: 1px solid rgba(69, 71, 90, 0.3);
        }
        
        .volume-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        
        .volume-label {
            color: #a6adc8;
            font-weight: normal;
            font-size: 10px;
        }
        
        .volume-value {
            color: #74c7ec;
            font-weight: bold;
            font-size: 11px;
        }
        
        .volume-value.positive {
            color: #a6e3a1;
        }
        
        .volume-value.negative {
            color: #f38ba8;
        }
        
        .no-alarms {
            text-align: center;
            padding: 40px;
            color: #a6adc8;
            font-size: 18px;
        }
        
        .refresh-btn {
            background-color: transparent;
            border: 1px solid #45475a;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            color: #a6adc8;
        }
        
        .refresh-btn:hover {
            background-color: #45475a;
            color: #cdd6f4;
        }
        
        .filter-info {
            font-size: 12px;
            color: #a6adc8;
            padding: 10px;
            background-color: #1e1e2e;
            border-radius: 6px;
            margin-top: 10px;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #a6e3a1;
            color: #1e1e2e;
            padding: 10px 15px;
            border-radius: 5px;
            z-index: 1000;
            font-weight: bold;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            animation: slideInRight 0.3s ease-out;
        }
        
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .copy-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .copy-button {
                width: 100%;
                justify-content: center;
            }
            
            .filter-section {
                flex-direction: column;
                align-items: stretch;
            }
            
            .filter-group {
                width: 100%;
            }
            
            select {
                width: 100%;
            }
            
            .stats {
                flex-direction: column;
            }
            
            .alarm-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .coin-info {
                width: 100%;
                justify-content: space-between;
            }
            
            .price-info {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .price-item {
                width: 100%;
            }
            
            .filter-options {
                flex-direction: column;
            }
            
            .filter-tag {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üö® Binance Alarm Mesajlarƒ±</h1>
        
        <div class="header-controls">
            <div>
                <button onclick="window.open('bilgi.html', '_blank')">üìä Ana Panele Git</button>
                <button onclick="clearAllAlarms()" class="clear-btn">üóëÔ∏è T√ºm√ºn√º Temizle</button>
            </div>
            <div>
                <button onclick="refreshAlarms()" class="refresh-btn">üîÑ Yenile</button>
                <span id="lastUpdate" class="time-info"></span>
            </div>
        </div>
        
        <!-- Kopyalama Kontrolleri -->
        <div class="copy-controls">
            <button class="copy-button select-all" onclick="selectAllCoins()">
                <span>‚úì</span> T√ºm√ºn√º Se√ß
            </button>
            <button class="copy-button deselect-all" onclick="deselectAllCoins()">
                <span>‚úó</span> Se√ßimi Temizle
            </button>
            <button class="copy-button copy-selected" onclick="copySelectedCoins()">
                <span>üìã</span> Se√ßilileri Kopyala
            </button>
            <button class="copy-button copy-all" onclick="copyAllCoins()">
                <span>üìÑ</span> T√ºm√ºn√º Kopyala
            </button>
            <div class="selected-count">
                Se√ßili: <span id="selectedCount">0</span>
            </div>
        </div>
        
        <!-- Filtre B√∂l√ºm√º -->
        <div class="filter-section">
            <div class="filter-group">
                <div class="filter-label">Coin Filtresi</div>
                <select id="coinFilter" onchange="applyFilters()">
                    <option value="all">T√ºm Coinler</option>
                </select>
            </div>
            
            <div class="filter-group">
                <div class="filter-label">Alarm T√ºr√º</div>
                <select id="typeFilter" onchange="applyFilters()">
                    <option value="all">T√ºm Alarm T√ºrleri</option>
                    <option value="upper_liquidity">√úst Likidite</option>
                    <option value="lower_liquidity">Alt Likidite</option>
                    <option value="20m_high">20M Y√ºksek</option>
                    <option value="20m_low">20M D√º≈ü√ºk</option>
                    <option value="15d_change">15D% Deƒüi≈üim</option>
                    <option value="4s_change">4S% Deƒüi≈üim</option>
                    <option value="1g_change">1G% Deƒüi≈üim</option>
                    <option value="ema50_above">EMA50 √úst√º</option>
                    <option value="ema50_below">EMA50 Altƒ±</option>
                    <option value="liquidity_percentage">Likidite %</option>
                </select>
            </div>
            
            <div class="filter-group">
                <div class="filter-label">Zaman Filtresi</div>
                <select id="timeFilter" onchange="applyFilters()">
                    <option value="all">T√ºm Zamanlar</option>
                    <option value="1hour">Son 1 Saat</option>
                    <option value="3hours">Son 3 Saat</option>
                    <option value="6hours">Son 6 Saat</option>
                    <option value="12hours">Son 12 Saat</option>
                    <option value="24hours">Son 24 Saat</option>
                </select>
            </div>
            
            <div style="align-self: flex-end;">
                <button onclick="clearFilters()" class="clear-filters-btn">Filtreleri Temizle</button>
            </div>
        </div>
        
        <!-- Hƒ±zlƒ± Filtre Butonlarƒ± -->
        <div class="filter-options">
            <div class="filter-tag" onclick="toggleFilter('type', 'upper_liquidity')" id="filter-upper">
                √úst Likidite
            </div>
            <div class="filter-tag" onclick="toggleFilter('type', 'lower_liquidity')" id="filter-lower">
                Alt Likidite
            </div>
            <div class="filter-tag" onclick="toggleFilter('type', '20m_high')" id="filter-high">
                20M Y√ºksek
            </div>
            <div class="filter-tag" onclick="toggleFilter('type', '20m_low')" id="filter-low">
                20M D√º≈ü√ºk
            </div>
            <div class="filter-tag" onclick="toggleFilter('type', '15d_change')" id="filter-15d">
                15D% Deƒüi≈üim
            </div>
            <div class="filter-tag" onclick="toggleFilter('type', '4s_change')" id="filter-4s">
                4S% Deƒüi≈üim
            </div>
            <div class="filter-tag" onclick="toggleFilter('type', '1g_change')" id="filter-1g">
                1G% Deƒüi≈üim
            </div>
            <div class="filter-tag" onclick="toggleFilter('type', 'ema50_above')" id="filter-ema-above">
                EMA50 √úst√º
            </div>
            <div class="filter-tag" onclick="toggleFilter('type', 'ema50_below')" id="filter-ema-below">
                EMA50 Altƒ±
            </div>
            <div class="filter-tag" onclick="toggleFilter('type', 'liquidity_percentage')" id="filter-liquidity-percent">
                Likidite %
            </div>
        </div>
        
        <!-- Filtre Bilgisi -->
        <div id="filterInfo" class="filter-info" style="display: none;">
            <span id="activeFiltersText"></span>
        </div>
        
        <!-- ƒ∞statistikler -->
        <div class="stats">
            <div class="stat-card">
                <div class="stat-label">Toplam Alarm</div>
                <div class="stat-value total" id="totalAlarms">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Filtrelenmi≈ü</div>
                <div class="stat-value filtered" id="filteredAlarms">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">√úst Likidite</div>
                <div class="stat-value upper" id="upperAlarms">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Alt Likidite</div>
                <div class="stat-value lower" id="lowerAlarms">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">20M Y√ºksek</div>
                <div class="stat-value high" id="highAlarms">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">20M D√º≈ü√ºk</div>
                <div class="stat-value low" id="lowAlarms">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">15D% Deƒüi≈üim</div>
                <div class="stat-value change" id="change15dAlarms">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">4S% Deƒüi≈üim</div>
                <div class="stat-value change" id="change4sAlarms">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">1G% Deƒüi≈üim</div>
                <div class="stat-value change" id="change1gAlarms">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">EMA50 √úst√º</div>
                <div class="stat-value ema" id="emaAboveAlarms">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">EMA50 Altƒ±</div>
                <div class="stat-value ema" id="emaBelowAlarms">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Likidite %</div>
                <div class="stat-value change" id="liquidityPercentAlarms">0</div>
            </div>
        </div>
        
        <!-- Alarm Listesi -->
        <div id="alarmList" class="alarm-list">
            <!-- Alarm mesajlarƒ± buraya gelecek -->
        </div>
    </div>

   <script>
    const ALARM_STORAGE_KEY = 'binanceAlarmMessages';
    const VOLUME_STORAGE_KEY = 'binanceVolumeData';
    
    // Alarm t√ºr√º CSS sƒ±nƒ±flarƒ±
    const alarmTypeClasses = {
        'upper_liquidity': {class: 'upper', typeClass: 'type-upper', name: '√úst Likidite'},
        'lower_liquidity': {class: 'lower', typeClass: 'type-lower', name: 'Alt Likidite'},
        '20m_high': {class: 'high', typeClass: 'type-high', name: '20M Y√ºksek'},
        '20m_low': {class: 'low', typeClass: 'type-low', name: '20M D√º≈ü√ºk'},
        '15d_change': {class: 'change', typeClass: 'type-change', name: '15D% Deƒüi≈üim'},
        '4s_change': {class: 'change', typeClass: 'type-change', name: '4S% Deƒüi≈üim'},
        '1g_change': {class: 'change', typeClass: 'type-change', name: '1G% Deƒüi≈üim'},
        'ema50_above': {class: 'ema', typeClass: 'type-ema', name: 'EMA50 √úst√º'},
        'ema50_below': {class: 'ema', typeClass: 'type-ema', name: 'EMA50 Altƒ±'},
        'liquidity_percentage': {class: 'change', typeClass: 'type-change', name: 'Likidite %'},
        'price_change': {class: 'change', typeClass: 'type-change', name: 'Fiyat Deƒüi≈üimi'}
    };
    
    // Filtre durumu
    let currentFilters = {
        coin: 'all',
        type: 'all',
        time: 'all'
    };
    
    // Se√ßili coin'leri saklamak i√ßin Set
    let selectedCoins = new Set();
    
    // Sunucudan alarm verilerini √ßek
    async function fetchAlarmsFromServer() {
        try {
            console.log('Sunucudan alarm verileri √ßekiliyor...');
            const response = await fetch('/api/alarms');
            if (!response.ok) throw new Error(`API hatasƒ±: ${response.status}`);
            
            const serverAlarms = await response.json();
            console.log(`Sunucudan ${serverAlarms.length} alarm alƒ±ndƒ±`);
            
            // LocalStorage'daki mevcut alarmlarƒ± al
            let localAlarms = JSON.parse(localStorage.getItem(ALARM_STORAGE_KEY)) || [];
            
            // Server alarmlarƒ±nƒ± local'e ekle (√ßift kayƒ±t olmamasƒ± i√ßin)
            serverAlarms.forEach(serverAlarm => {
                const exists = localAlarms.find(localAlarm => 
                    localAlarm.id === serverAlarm.id || (
                        localAlarm.symbol === serverAlarm.symbol && 
                        localAlarm.alarmType === serverAlarm.alarmType &&
                        Math.abs(new Date(localAlarm.timestamp).getTime() - new Date(serverAlarm.timestamp).getTime()) < 60000
                    )
                );
                
                if (!exists) {
                    localAlarms.unshift(serverAlarm);
                }
            });
            
            // ID'leri kontrol et (eski alarmlar i√ßin ID olu≈ütur)
            localAlarms = localAlarms.map(alarm => {
                if (!alarm.id) {
                    return {
                        ...alarm,
                        id: Date.now() + Math.random().toString(36).substr(2, 9)
                    };
                }
                return alarm;
            });
            
            // Sadece son 100 alarmƒ± tut
            if (localAlarms.length > 100) {
                localAlarms = localAlarms.slice(0, 100);
            }
            
            // LocalStorage'a kaydet
            localStorage.setItem(ALARM_STORAGE_KEY, JSON.stringify(localAlarms));
            console.log(`Toplam ${localAlarms.length} alarm kaydedildi`);
            
            // Hacim verilerini de √ßek
            await fetchVolumeDataFromServer();
            
            return localAlarms;
        } catch (error) {
            console.error('Sunucudan alarm √ßekme hatasƒ±:', error);
            // Hata durumunda local storage'dan y√ºkle
            const localAlarms = JSON.parse(localStorage.getItem(ALARM_STORAGE_KEY)) || [];
            console.log(`Local storage'dan ${localAlarms.length} alarm y√ºklendi`);
            return localAlarms;
        }
    }
    
    // Sunucudan hacim verilerini √ßek
    async function fetchVolumeDataFromServer() {
        try {
            console.log('Hacim verileri √ßekiliyor...');
            const response = await fetch('/api/volume-data');
            if (!response.ok) throw new Error(`API hatasƒ±: ${response.status}`);
            
            const serverVolumeData = await response.json();
            const localVolumeData = JSON.parse(localStorage.getItem(VOLUME_STORAGE_KEY)) || {};
            
            // Server verilerini local'e merge et
            Object.keys(serverVolumeData).forEach(symbol => {
                localVolumeData[symbol] = {
                    ...localVolumeData[symbol],
                    ...serverVolumeData[symbol],
                    lastUpdate: new Date().toISOString()
                };
            });
            
            localStorage.setItem(VOLUME_STORAGE_KEY, JSON.stringify(localVolumeData));
            console.log(`Hacim verileri g√ºncellendi: ${Object.keys(localVolumeData).length} coin`);
        } catch (error) {
            console.error('Hacim verisi √ßekme hatasƒ±:', error);
        }
    }
    
    // Alarmlarƒ± y√ºkle ve g√∂ster
    async function loadAlarms() {
        console.log('Alarmlar y√ºkleniyor...');
        
        // √ñnce sunucudan alarmlarƒ± √ßek
        const alarms = await fetchAlarmsFromServer();
        const volumeData = JSON.parse(localStorage.getItem(VOLUME_STORAGE_KEY)) || {};
        const alarmList = document.getElementById('alarmList');
        
        console.log(`Toplam ${alarms.length} alarm i≈üleniyor`);
        
        // Coin filtre se√ßeneklerini g√ºncelle
        updateCoinFilterOptions(alarms);
        
        // ƒ∞statistikleri hesapla
        updateStatistics(alarms);
        
        // Alarmlarƒ± filtrele
        const filteredAlarms = filterAlarms(alarms);
        
        if (filteredAlarms.length === 0) {
            alarmList.innerHTML = `
                <div class="no-alarms">
                    <p>üì≠ ${getNoAlarmsMessage()}</p>
                    <p><small>${getFilterInfoText()}</small></p>
                </div>
            `;
            updateSelectedCount();
            
            // Son g√ºncelleme zamanƒ±nƒ± g√∂ster
            document.getElementById('lastUpdate').textContent = 
                `Son g√ºncelleme: ${new Date().toLocaleTimeString('tr-TR', {
                    hour: '2-digit',
                    minute: '2-digit'
                })}`;
            return;
        }
        
        let html = '';
        
        filteredAlarms.forEach(alarm => {
            const typeInfo = alarmTypeClasses[alarm.alarmType] || {class: '', typeClass: '', name: alarm.alarmType};
            const isSelected = selectedCoins.has(alarm.symbol);
            const shortSymbol = alarm.shortSymbol || alarm.symbol.replace('USDT', '');
            
            // Hacim verilerini al
            const volumeInfo = volumeData[alarm.symbol] || {};
            const quoteVolume = volumeInfo.quoteVolume24h || 0;
            const coinVolume = volumeInfo.volume24h || 0;
            const volumeRatio = volumeInfo.volumeRatio || '0%';
            const volumePrice = volumeInfo.price || alarm.currentPrice;
            
            // Zaman formatƒ±
            const time = new Date(alarm.timestamp);
            const timeText = alarm.timeText || time.toLocaleTimeString('tr-TR', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            const dateText = time.toLocaleDateString('tr-TR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
            
            // Ne kadar zaman √∂nce
            const timeAgo = getTimeAgo(time);
            
            // Hacim bilgileri HTML'i
            const volumeHtml = `
                <div class="volume-info">
                    <div class="volume-item">
                        <span class="volume-label">24S USDT:</span>
                        <span class="volume-value">${formatVolume(quoteVolume)}</span>
                    </div>
                    <div class="volume-item">
                        <span class="volume-label">24S Coin:</span>
                        <span class="volume-value">${formatVolume(coinVolume)}</span>
                    </div>
                    <div class="volume-item">
                        <span class="volume-label">Hacim Oranƒ±:</span>
                        <span class="volume-value ${getVolumeRatioClass(volumeRatio)}">${volumeRatio}</span>
                    </div>
                </div>
            `;
            
            // Alarm tipine g√∂re farklƒ± g√∂r√ºnt√ºleme
            if (alarm.alarmType.includes('_change') && alarm.alarmType !== 'liquidity_percentage') {
                // Deƒüi≈üim y√ºzdesi alarmlarƒ±
                const changeValue = alarm.changePercent || alarm.targetPrice || 0;
                const isPositive = parseFloat(changeValue) >= 0;
                const changeClass = isPositive ? 'diff-positive' : 'diff-negative';
                const changeText = isPositive ? 'Y√úKSELƒ∞≈û' : 'D√ú≈û√ú≈û';
                
                html += `
                    <div class="alarm-item ${typeInfo.class}">
                        <div class="alarm-header">
                            <div class="coin-info">
                                <div class="coin-symbol-container">
                                    <input type="checkbox" class="coin-checkbox" 
                                           data-symbol="${alarm.symbol}"
                                           ${isSelected ? 'checked' : ''}
                                           onchange="toggleCoinSelection('${alarm.symbol}', this)">
                                    <span class="coin-symbol ${isSelected ? 'selected' : ''}" 
                                          onclick="copySingleCoin('${alarm.symbol}')">
                                        ${shortSymbol}
                                    </span>
                                    <button class="copy-icon" onclick="copySingleCoin('${alarm.symbol}', event)">
                                        üìã
                                    </button>
                                </div>
                                <span class="alarm-type ${typeInfo.typeClass}">${typeInfo.name}</span>
                            </div>
                            <div class="time-info">
                                <div>${timeText}</div>
                                <div>${dateText} ‚Ä¢ ${timeAgo}</div>
                            </div>
                        </div>
                        
                        <div class="price-info">
                            <div class="price-item">
                                <div class="price-label">Mevcut Fiyat</div>
                                <div class="price-value current-price">${volumePrice.toFixed(6)}</div>
                            </div>
                            <div class="price-item">
                                <div class="price-label">Deƒüi≈üim Oranƒ±</div>
                                <div class="price-value target-price ${isPositive ? 'positive' : 'negative'}">
                                    ${isPositive ? '+' : ''}${Math.abs(parseFloat(changeValue)).toFixed(2)}%
                                </div>
                            </div>
                            <div class="price-item">
                                <div class="price-label">Durum</div>
                                <div class="price-value">
                                    <span class="difference ${changeClass}">
                                        ${changeText}
                                    </span>
                                </div>
                            </div>
                        </div>
                        ${volumeHtml}
                    </div>
                `;
            } else if (alarm.alarmType === 'liquidity_percentage') {
                // Likidite y√ºzdesi alarmlarƒ±
                const percentValue = alarm.targetPrice || 0;
                const isPositive = parseFloat(percentValue) >= 0;
                const changeClass = isPositive ? 'diff-positive' : 'diff-negative';
                const changeText = isPositive ? '√úST√úNDE' : 'ALTINDA';
                
                html += `
                    <div class="alarm-item ${typeInfo.class}">
                        <div class="alarm-header">
                            <div class="coin-info">
                                <div class="coin-symbol-container">
                                    <input type="checkbox" class="coin-checkbox" 
                                           data-symbol="${alarm.symbol}"
                                           ${isSelected ? 'checked' : ''}
                                           onchange="toggleCoinSelection('${alarm.symbol}', this)">
                                    <span class="coin-symbol ${isSelected ? 'selected' : ''}" 
                                          onclick="copySingleCoin('${alarm.symbol}')">
                                        ${shortSymbol}
                                    </span>
                                    <button class="copy-icon" onclick="copySingleCoin('${alarm.symbol}', event)">
                                        üìã
                                    </button>
                                </div>
                                <span class="alarm-type ${typeInfo.typeClass}">${typeInfo.name}</span>
                            </div>
                            <div class="time-info">
                                <div>${timeText}</div>
                                <div>${dateText} ‚Ä¢ ${timeAgo}</div>
                            </div>
                        </div>
                        
                        <div class="price-info">
                            <div class="price-item">
                                <div class="price-label">Mevcut Fiyat</div>
                                <div class="price-value current-price">${volumePrice.toFixed(6)}</div>
                            </div>
                            <div class="price-item">
                                <div class="price-label">4S Alt Likidite Farkƒ±</div>
                                <div class="price-value target-price ${isPositive ? 'positive' : 'negative'}">
                                    ${isPositive ? '+' : ''}${Math.abs(parseFloat(percentValue)).toFixed(2)}%
                                </div>
                            </div>
                            <div class="price-item">
                                <div class="price-label">Konum</div>
                                <div class="price-value">
                                    <span class="difference ${changeClass}">
                                        ${changeText}
                                    </span>
                                </div>
                            </div>
                        </div>
                        ${volumeHtml}
                    </div>
                `;
            } else if (alarm.alarmType.includes('ema50')) {
                // EMA50 alarmlarƒ±
                const isAbove = alarm.alarmType.includes('above');
                const diffClass = isAbove ? 'diff-positive' : 'diff-negative';
                const emaDirection = isAbove ? '√úZERƒ∞NDE' : 'ALTINDA';
                
                html += `
                    <div class="alarm-item ${typeInfo.class}">
                        <div class="alarm-header">
                            <div class="coin-info">
                                <div class="coin-symbol-container">
                                    <input type="checkbox" class="coin-checkbox" 
                                           data-symbol="${alarm.symbol}"
                                           ${isSelected ? 'checked' : ''}
                                           onchange="toggleCoinSelection('${alarm.symbol}', this)">
                                    <span class="coin-symbol ${isSelected ? 'selected' : ''}" 
                                          onclick="copySingleCoin('${alarm.symbol}')">
                                        ${shortSymbol}
                                    </span>
                                    <button class="copy-icon" onclick="copySingleCoin('${alarm.symbol}', event)">
                                        üìã
                                    </button>
                                </div>
                                <span class="alarm-type ${typeInfo.typeClass}">${typeInfo.name}</span>
                            </div>
                            <div class="time-info">
                                <div>${timeText}</div>
                                <div>${dateText} ‚Ä¢ ${timeAgo}</div>
                            </div>
                        </div>
                        
                        <div class="price-info">
                            <div class="price-item">
                                <div class="price-label">Mevcut Fiyat</div>
                                <div class="price-value current-price">${volumePrice.toFixed(6)}</div>
                            </div>
                            <div class="price-item">
                                <div class="price-label">EMA50 Seviyesi</div>
                                <div class="price-value target-price">${(alarm.targetPrice || 0).toFixed(6)}</div>
                            </div>
                            <div class="price-item">
                                <div class="price-label">Konum</div>
                                <div class="price-value">
                                    <span class="difference ${diffClass}">
                                        ${emaDirection}
                                    </span>
                                </div>
                            </div>
                        </div>
                        ${volumeHtml}
                    </div>
                `;
            } else {
                // Diƒüer alarmlar (likidite ve high/low)
                const targetPrice = alarm.targetPrice || 0;
                const difference = targetPrice !== 0 ? ((alarm.currentPrice - targetPrice) / targetPrice) * 100 : 0;
                const diffClass = difference >= 0 ? 'diff-positive' : 'diff-negative';
                const diffSymbol = difference >= 0 ? '+' : '';
                const diffText = difference >= 0 ? '√úZERƒ∞NDE' : 'ALTINDA';
                
                html += `
                    <div class="alarm-item ${typeInfo.class}">
                        <div class="alarm-header">
                            <div class="coin-info">
                                <div class="coin-symbol-container">
                                    <input type="checkbox" class="coin-checkbox" 
                                           data-symbol="${alarm.symbol}"
                                           ${isSelected ? 'checked' : ''}
                                           onchange="toggleCoinSelection('${alarm.symbol}', this)">
                                    <span class="coin-symbol ${isSelected ? 'selected' : ''}" 
                                          onclick="copySingleCoin('${alarm.symbol}')">
                                        ${shortSymbol}
                                    </span>
                                    <button class="copy-icon" onclick="copySingleCoin('${alarm.symbol}', event)">
                                        üìã
                                    </button>
                                </div>
                                <span class="alarm-type ${typeInfo.typeClass}">${typeInfo.name}</span>
                            </div>
                            <div class="time-info">
                                <div>${timeText}</div>
                                <div>${dateText} ‚Ä¢ ${timeAgo}</div>
                            </div>
                        </div>
                        
                        <div class="price-info">
                            <div class="price-item">
                                <div class="price-label">Mevcut Fiyat</div>
                                <div class="price-value current-price">${volumePrice.toFixed(6)}</div>
                            </div>
                            <div class="price-item">
                                <div class="price-label">Hedef Fiyat</div>
                                <div class="price-value target-price">${targetPrice.toFixed(6)}</div>
                            </div>
                            <div class="price-item">
                                <div class="price-label">Fark</div>
                                <div class="price-value">
                                    ${targetPrice !== 0 ? `${diffSymbol}${Math.abs(difference).toFixed(2)}%` : '-'}
                                    ${targetPrice !== 0 ? `<span class="difference ${diffClass}">
                                        ${diffText}
                                    </span>` : ''}
                                </div>
                            </div>
                        </div>
                        ${volumeHtml}
                    </div>
                `;
            }
        });
        
        alarmList.innerHTML = html;
        
        // Son g√ºncelleme zamanƒ±nƒ± g√∂ster
        document.getElementById('lastUpdate').textContent = 
            `Son g√ºncelleme: ${new Date().toLocaleTimeString('tr-TR', {
                hour: '2-digit',
                minute: '2-digit'
            })}`;
        
        // Filtre bilgisini g√ºncelle
        updateFilterInfo();
        
        // Se√ßili sayƒ±sƒ±nƒ± g√ºncelle
        updateSelectedCount();
        
        console.log('Alarmlar ba≈üarƒ±yla y√ºklendi');
    }
    
    // Hacim oranƒ± sƒ±nƒ±fƒ±nƒ± belirle
    function getVolumeRatioClass(ratioStr) {
        if (ratioStr === '-' || !ratioStr) return '';
        
        const ratio = parseFloat(ratioStr);
        if (isNaN(ratio)) return '';
        
        if (ratio > 120) return 'positive'; // %120'den fazla = pozitif
        if (ratio < 80) return 'negative';  // %80'den az = negatif
        return ''; // %80-120 arasƒ± = n√∂tr
    }
    
    // Hacim formatlama
    function formatVolume(value) {
        if (value === undefined || value === null || value === 0) return '-';
        
        const num = parseFloat(value);
        
        if (num >= 1000000000) {
            return (num / 1000000000).toFixed(2) + 'B';
        } else if (num >= 1000000) {
            return (num / 1000000).toFixed(2) + 'M';
        } else if (num >= 1000) {
            return (num / 1000000).toFixed(2) + 'K';
        } else if (num < 1) {
            return num.toFixed(6);
        } else {
            return num.toFixed(2);
        }
    }
    
    // Tekil coin kopyalama
    function copySingleCoin(symbol, event = null) {
        if (event) {
            event.stopPropagation();
        }
        
        const fullSymbol = symbol.includes('USDT') ? symbol : symbol + 'USDT';
        
        navigator.clipboard.writeText(fullSymbol).then(() => {
            showNotification(`üìã ${fullSymbol} kopyalandƒ±`);
        }).catch(err => {
            console.error('Kopyalama hatasƒ±:', err);
            showNotification('‚ùå Kopyalama ba≈üarƒ±sƒ±z!', true);
        });
    }
    
    // Coin se√ßimini deƒüi≈ütir
    function toggleCoinSelection(symbol, checkbox) {
        if (checkbox.checked) {
            selectedCoins.add(symbol);
        } else {
            selectedCoins.delete(symbol);
        }
        
        // Coin sembol√º g√∂rselini g√ºncelle
        const coinSymbol = checkbox.parentElement.querySelector('.coin-symbol');
        if (coinSymbol) {
            if (checkbox.checked) {
                coinSymbol.classList.add('selected');
            } else {
                coinSymbol.classList.remove('selected');
            }
        }
        
        // Se√ßili sayƒ±sƒ±nƒ± g√ºncelle
        updateSelectedCount();
    }
    
    // T√ºm coin'leri se√ß
    function selectAllCoins() {
        const alarms = JSON.parse(localStorage.getItem(ALARM_STORAGE_KEY)) || [];
        const filteredAlarms = filterAlarms(alarms);
        
        selectedCoins.clear();
        
        filteredAlarms.forEach(alarm => {
            selectedCoins.add(alarm.symbol);
        });
        
        // Checkbox'larƒ± g√ºncelle
        document.querySelectorAll('.coin-checkbox').forEach(checkbox => {
            checkbox.checked = true;
        });
        
        // Coin sembollerini g√ºncelle
        document.querySelectorAll('.coin-symbol').forEach(symbol => {
            symbol.classList.add('selected');
        });
        
        updateSelectedCount();
        showNotification(`‚úÖ ${selectedCoins.size} coin se√ßildi`);
    }
    
    // T√ºm se√ßimi temizle
    function deselectAllCoins() {
        selectedCoins.clear();
        
        // Checkbox'larƒ± g√ºncelle
        document.querySelectorAll('.coin-checkbox').forEach(checkbox => {
            checkbox.checked = false;
        });
        
        // Coin sembollerini g√ºncelle
        document.querySelectorAll('.coin-symbol').forEach(symbol => {
            symbol.classList.remove('selected');
        });
        
        updateSelectedCount();
        showNotification('‚úó Se√ßim temizlendi');
    }
    
    // Se√ßili coin'leri kopyala (satƒ±rlƒ±, USDT ekli)
    function copySelectedCoins() {
        if (selectedCoins.size === 0) {
            showNotification('‚ö†Ô∏è Kopyalamak i√ßin coin se√ßin!', true);
            return;
        }
        
        const coinList = Array.from(selectedCoins)
            .map(symbol => symbol.includes('USDT') ? symbol : symbol + 'USDT')
            .join('\n');
        
        navigator.clipboard.writeText(coinList).then(() => {
            showNotification(`üìã ${selectedCoins.size} coin kopyalandƒ±:\n${coinList}`);
        }).catch(err => {
            console.error('Toplu kopyalama hatasƒ±:', err);
            showNotification('‚ùå Kopyalama ba≈üarƒ±sƒ±z!', true);
        });
    }
    
    // T√ºm coin'leri kopyala (mevcut filtreye g√∂re)
    function copyAllCoins() {
        const alarms = JSON.parse(localStorage.getItem(ALARM_STORAGE_KEY)) || [];
        const filteredAlarms = filterAlarms(alarms);
        
        if (filteredAlarms.length === 0) {
            showNotification('‚ö†Ô∏è Kopyalanacak coin yok!', true);
            return;
        }
        
        // Benzersiz coin'leri al
        const uniqueCoins = new Set();
        filteredAlarms.forEach(alarm => {
            uniqueCoins.add(alarm.symbol);
        });
        
        const coinList = Array.from(uniqueCoins)
            .map(symbol => symbol.includes('USDT') ? symbol : symbol + 'USDT')
            .join('\n');
        
        navigator.clipboard.writeText(coinList).then(() => {
            showNotification(`üìã ${uniqueCoins.size} coin kopyalandƒ±:\n${coinList}`);
        }).catch(err => {
            console.error('T√ºm√ºn√º kopyalama hatasƒ±:', err);
            showNotification('‚ùå Kopyalama ba≈üarƒ±sƒ±z!', true);
        });
    }
    
    // Se√ßili sayƒ±sƒ±nƒ± g√ºncelle
    function updateSelectedCount() {
        document.getElementById('selectedCount').textContent = selectedCoins.size;
    }
    
    // Alarmlarƒ± filtrele
    function filterAlarms(alarms) {
        return alarms.filter(alarm => {
            // Coin filtre
            if (currentFilters.coin !== 'all' && alarm.symbol !== currentFilters.coin) {
                return false;
            }
            
            // Alarm tipi filtre
            if (currentFilters.type !== 'all' && alarm.alarmType !== currentFilters.type) {
                return false;
            }
            
            // Zaman filtre
            if (currentFilters.time !== 'all') {
                const alarmTime = new Date(alarm.timestamp).getTime();
                const now = Date.now();
                let timeLimit = 0;
                
                switch(currentFilters.time) {
                    case '1hour': timeLimit = 60 * 60 * 1000; break;
                    case '3hours': timeLimit = 3 * 60 * 60 * 1000; break;
                    case '6hours': timeLimit = 6 * 60 * 60 * 1000; break;
                    case '12hours': timeLimit = 12 * 60 * 60 * 1000; break;
                    case '24hours': timeLimit = 24 * 60 * 60 * 1000; break;
                }
                
                if (now - alarmTime > timeLimit) {
                    return false;
                }
            }
            
            return true;
        });
    }
    
    // Coin filtre se√ßeneklerini g√ºncelle
    function updateCoinFilterOptions(alarms) {
        const coinFilter = document.getElementById('coinFilter');
        const coins = new Set();
        
        // T√ºm alarmlardaki coin'leri topla
        alarms.forEach(alarm => {
            coins.add(alarm.symbol);
        });
        
        // Mevcut se√ßenekleri temizle (ilk se√ßenek hari√ß)
        while (coinFilter.options.length > 1) {
            coinFilter.remove(1);
        }
        
        // Coin'leri alfabetik sƒ±rayla ekle
        Array.from(coins).sort().forEach(symbol => {
            const option = document.createElement('option');
            option.value = symbol;
            option.textContent = `${symbol.replace('USDT', '')} (${symbol})`;
            coinFilter.appendChild(option);
        });
        
        // Mevcut filtreyi uygula
        coinFilter.value = currentFilters.coin;
    }
    
    // ƒ∞statistikleri g√ºncelle
    function updateStatistics(alarms) {
        const total = alarms.length;
        const filtered = filterAlarms(alarms).length;
        
        // Alarm t√ºrlerine g√∂re sayƒ±larƒ± hesapla
        let upperCount = 0, lowerCount = 0, highCount = 0, lowCount = 0;
        let change15dCount = 0, change4sCount = 0, change1gCount = 0, priceChangeCount = 0;
        let emaAboveCount = 0, emaBelowCount = 0;
        let liquidityPercentCount = 0;
        
        alarms.forEach(alarm => {
            switch(alarm.alarmType) {
                case 'upper_liquidity': upperCount++; break;
                case 'lower_liquidity': lowerCount++; break;
                case '20m_high': highCount++; break;
                case '20m_low': lowCount++; break;
                case '15d_change': change15dCount++; break;
                case '4s_change': change4sCount++; break;
                case '1g_change': change1gCount++; break;
                case 'price_change': priceChangeCount++; break;
                case 'ema50_above': emaAboveCount++; break;
                case 'ema50_below': emaBelowCount++; break;
                case 'liquidity_percentage': liquidityPercentCount++; break;
            }
        });
        
        // ƒ∞statistikleri g√∂ster
        document.getElementById('totalAlarms').textContent = total;
        document.getElementById('filteredAlarms').textContent = filtered;
        document.getElementById('upperAlarms').textContent = upperCount;
        document.getElementById('lowerAlarms').textContent = lowerCount;
        document.getElementById('highAlarms').textContent = highCount;
        document.getElementById('lowAlarms').textContent = lowCount;
        document.getElementById('change15dAlarms').textContent = change15dCount;
        document.getElementById('change4sAlarms').textContent = change4sCount;
        document.getElementById('change1gAlarms').textContent = change1gCount;
        document.getElementById('emaAboveAlarms').textContent = emaAboveCount;
        document.getElementById('emaBelowAlarms').textContent = emaBelowCount;
        document.getElementById('liquidityPercentAlarms').textContent = liquidityPercentCount;
    }
    
    // Filtreleri uygula
    function applyFilters() {
        currentFilters.coin = document.getElementById('coinFilter').value;
        currentFilters.type = document.getElementById('typeFilter').value;
        currentFilters.time = document.getElementById('timeFilter').value;
        
        // Hƒ±zlƒ± filtre butonlarƒ±nƒ± g√ºncelle
        updateQuickFilterButtons();
        
        // Se√ßili coin'leri temizle (filtre deƒüi≈ütiƒüinde)
        selectedCoins.clear();
        
        loadAlarms();
    }
    
    // Hƒ±zlƒ± filtre butonlarƒ±nƒ± g√ºncelle
    function updateQuickFilterButtons() {
        const filterButtons = [
            'upper', 'lower', 'high', 'low', 
            '15d', '4s', '1g', 'ema-above', 'ema-below', 'liquidity-percent'
        ];
        
        filterButtons.forEach(type => {
            const button = document.getElementById(`filter-${type}`);
            const filterType = getFilterTypeFromButton(type);
            
            if (button) {
                if (currentFilters.type === filterType) {
                    button.classList.add('active');
                } else {
                    button.classList.remove('active');
                }
            }
        });
    }
    
    // Buton tipinden filtre tipine d√∂n√º≈üt√ºr
    function getFilterTypeFromButton(buttonType) {
        switch(buttonType) {
            case 'upper': return 'upper_liquidity';
            case 'lower': return 'lower_liquidity';
            case 'high': return '20m_high';
            case 'low': return '20m_low';
            case '15d': return '15d_change';
            case '4s': return '4s_change';
            case '1g': return '1g_change';
            case 'ema-above': return 'ema50_above';
            case 'ema-below': return 'ema50_below';
            case 'liquidity-percent': return 'liquidity_percentage';
            default: return 'all';
        }
    }
    
    // Hƒ±zlƒ± filtre butonuna tƒ±klandƒ±ƒüƒ±nda
    function toggleFilter(filterKey, filterValue) {
        if (currentFilters[filterKey] === filterValue) {
            // Aynƒ± filtreye tekrar tƒ±klandƒ±ƒüƒ±nda filtreyi kaldƒ±r
            currentFilters[filterKey] = 'all';
            document.getElementById('typeFilter').value = 'all';
        } else {
            // Yeni filtre uygula
            currentFilters[filterKey] = filterValue;
            document.getElementById('typeFilter').value = filterValue;
        }
        
        // Se√ßili coin'leri temizle (filtre deƒüi≈ütiƒüinde)
        selectedCoins.clear();
        
        loadAlarms();
    }
    
    // T√ºm alarmlarƒ± temizle
    function clearAllAlarms() {
        if (confirm('T√ºm alarm mesajlarƒ±nƒ± ve hacim verilerini silmek istediƒüinize emin misiniz?\n\nBu i≈ülem geri alƒ±namaz!')) {
            localStorage.removeItem(ALARM_STORAGE_KEY);
            localStorage.removeItem(VOLUME_STORAGE_KEY);
            currentFilters = { coin: 'all', type: 'all', time: 'all' };
            selectedCoins.clear();
            resetFilters();
            loadAlarms();
            showNotification('üóëÔ∏è T√ºm alarmlar ve hacim verileri temizlendi');
        }
    }
    
    // Filtreleri temizle
    function clearFilters() {
        currentFilters = { coin: 'all', type: 'all', time: 'all' };
        selectedCoins.clear();
        resetFilters();
        loadAlarms();
        showNotification('üßπ Filtreler temizlendi');
    }
    
    // Filtreleri sƒ±fƒ±rla
    function resetFilters() {
        document.getElementById('coinFilter').value = 'all';
        document.getElementById('typeFilter').value = 'all';
        document.getElementById('timeFilter').value = 'all';
        updateQuickFilterButtons();
        updateFilterInfo();
    }
    
    // Alarmlarƒ± yenile
    async function refreshAlarms() {
        console.log('Alarmlar manuel yenileniyor...');
        showNotification('üîÑ Alarmlar yenileniyor...');
        await loadAlarms();
        showNotification('‚úÖ Alarmlar yenilendi');
    }
    
    // Ne kadar zaman √∂nce hesapla
    function getTimeAgo(date) {
        const now = new Date();
        const diffMs = now - date;
        const diffMins = Math.floor(diffMs / 60000);
        const diffHours = Math.floor(diffMins / 60);
        const diffDays = Math.floor(diffHours / 24);
        
        if (diffDays > 0) {
            return `${diffDays} g√ºn √∂nce`;
        } else if (diffHours > 0) {
            return `${diffHours} saat √∂nce`;
        } else if (diffMins > 0) {
            return `${diffMins} dakika √∂nce`;
        } else {
            return 'az √∂nce';
        }
    }
    
    // Alarm yok mesajƒ±
    function getNoAlarmsMessage() {
        if (currentFilters.coin !== 'all' || currentFilters.type !== 'all' || currentFilters.time !== 'all') {
            return 'Filtreye uygun alarm bulunamadƒ±';
        }
        return 'Hen√ºz alarm mesajƒ± yok';
    }
    
    // Filtre bilgisi metni
    function getFilterInfoText() {
        const parts = [];
        
        if (currentFilters.coin !== 'all') {
            parts.push(`Coin: ${currentFilters.coin.replace('USDT', '')}`);
        }
        
        if (currentFilters.type !== 'all') {
            const typeName = alarmTypeClasses[currentFilters.type]?.name || currentFilters.type;
            parts.push(`T√ºr: ${typeName}`);
        }
        
        if (currentFilters.time !== 'all') {
            const timeNames = {
                '1hour': 'Son 1 Saat',
                '3hours': 'Son 3 Saat',
                '6hours': 'Son 6 Saat',
                '12hours': 'Son 12 Saat',
                '24hours': 'Son 24 Saat'
            };
            parts.push(`Zaman: ${timeNames[currentFilters.time] || currentFilters.time}`);
        }
        
        if (parts.length > 0) {
            return `Aktif filtreler: ${parts.join(', ')}`;
        }
        
        return 'Coinler seviyelere yakla≈ütƒ±ƒüƒ±nda mesajlar burada g√∂r√ºnecek';
    }
    
    // Filtre bilgisini g√ºncelle
    function updateFilterInfo() {
        const filterInfo = document.getElementById('filterInfo');
        const activeFiltersText = document.getElementById('activeFiltersText');
        
        const parts = [];
        
        if (currentFilters.coin !== 'all') {
            parts.push(`Coin: ${currentFilters.coin.replace('USDT', '')}`);
        }
        
        if (currentFilters.type !== 'all') {
            const typeName = alarmTypeClasses[currentFilters.type]?.name || currentFilters.type;
            parts.push(`T√ºr: ${typeName}`);
        }
        
        if (currentFilters.time !== 'all') {
            const timeNames = {
                '1hour': 'Son 1 Saat',
                '3hours': 'Son 3 Saat',
                '6hours': 'Son 6 Saat',
                '12hours': 'Son 12 Saat',
                '24hours': 'Son 24 Saat'
            };
            parts.push(`Zaman: ${timeNames[currentFilters.time] || currentFilters.time}`);
        }
        
        if (parts.length > 0) {
            activeFiltersText.textContent = `Aktif Filtreler: ${parts.join(' ‚Ä¢ ')}`;
            filterInfo.style.display = 'block';
        } else {
            filterInfo.style.display = 'none';
        }
    }
    
    // Bildirim g√∂ster
    function showNotification(message, isError = false) {
        // Mevcut bildirimleri temizle
        const existingNotification = document.querySelector('.notification');
        if (existingNotification) {
            existingNotification.remove();
        }
        
        // Yeni bildirim olu≈ütur
        const notification = document.createElement('div');
        notification.className = 'notification';
        notification.textContent = message;
        notification.style.backgroundColor = isError ? '#f38ba8' : '#a6e3a1';
        notification.style.color = '#1e1e2e';
        
        // √áok satƒ±rlƒ± mesajlar i√ßin
        if (message.includes('\n')) {
            notification.style.whiteSpace = 'pre-line';
            notification.style.textAlign = 'left';
            notification.style.maxWidth = '400px';
        }
        
        document.body.appendChild(notification);
        
        // 3 saniye sonra kaldƒ±r
        setTimeout(() => {
            if (notification.parentNode) {
                notification.remove();
            }
        }, 3000);
    }
    
    // Sayfa y√ºklendiƒüinde
    window.onload = async function() {
        console.log('Alarm sayfasƒ± y√ºkleniyor...');
        
        // Test: API'ler √ßalƒ±≈üƒ±yor mu?
        try {
            const testResponse = await fetch('/api/alarms');
            console.log('API testi:', testResponse.ok ? 'BA≈ûARILI' : 'BA≈ûARISIZ');
        } catch (error) {
            console.error('API baƒülantƒ± hatasƒ±:', error);
        }
        
        // Alarmlarƒ± y√ºkle
        await loadAlarms();
        
        // Hƒ±zlƒ± filtre butonlarƒ±nƒ± g√ºncelle
        updateQuickFilterButtons();
        
        console.log('Alarm sayfasƒ± hazƒ±r');
        
        // Her 30 saniyede bir otomatik yenile
        setInterval(async () => {
            console.log('Otomatik yenileme...');
            await loadAlarms();
        }, 30000);
        
        // 10 saniye sonra tekrar y√ºkle (ilk y√ºkleme i√ßin)
        setTimeout(async () => {
            console.log('ƒ∞lk yenileme...');
            await loadAlarms();
        }, 10000);
    };
</script>
</body>
</html>
